{% extends "base.html" %}

{% block title %}{{ recipe.title }} · FoodPlanner{% endblock %}

{% block content %}
<section class="recipe-detail">
    <div class="container recipe-detail__card">
        <div class="recipe-detail__header">
            <div>
                <p class="recipe-detail__meta">
                    Автор:
                    <a href="{{ url_for('user_profile', user_id=recipe.author.id) }}" class="link-pill">
                        <span class="link-pill__avatar">{{ (recipe.author.full_name or recipe.author.email)[0]|upper }}</span>
                        <span>{{ recipe.author.full_name or recipe.author.email }}</span>
                    </a>
                </p>
                <h1>{{ recipe.title }}</h1>
                <form method="post" action="{{ url_for('toggle_recipe_view') }}" class="form-actions" style="margin:8px 0;">
                    <input type="hidden" name="next_url" value="{{ request.url.path }}" />
                    <label class="checkbox-ios" for="toggle-view">
                        <input
                            type="checkbox"
                            id="toggle-view"
                            name="minimal"
                            {% if not minimal_view %}checked{% endif %}
                        />
                        <span class="checkbox-ios-switch"></span>
                        <span class="toggle__label"></span>
                    </label>
                </form>
                {% if recipe.description %}
                <p class="recipe-detail__description">{{ recipe.description }}</p>
                {% endif %}
                {% if recipe.tags %}
                <div class="recipe-tags">
                    {% for tag in recipe.tags %}
                    <span class="badge badge--tag">
                        {{ tag_labels.get(tag, tag) if tag_labels else tag }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if current_user and (recipe.user_id == current_user.id or current_user.is_admin) %}
                <div class="recipe-detail__actions">
                    <a
                        href="{{ url_for('recipes_edit', recipe_id=recipe.id) }}"
                        class="btn btn--ghost"
                        >Редактировать</a
                    >
                    <form
                        method="post"
                        action="{{ url_for('delete_recipe', recipe_id=recipe.id) }}"
                        onsubmit="return confirm('Удалить рецепт без возможности восстановления?');"
                    >
                        <button type="submit" class="btn btn--ghost btn--danger">Удалить</button>
                    </form>
                </div>
                {% endif %}
            </div>
            <img src="{{ cover_url(recipe) }}" alt="{{ recipe.title }}" class="recipe-detail__cover" />
        </div>
        {% if recipe.ingredients %}
        <div class="recipe-ingredients">
            <h2>Ингредиенты</h2>
            <ul>
                {% for item in recipe.ingredients %}
                <li>
                    <span>{{ item.name }}</span>
                    <span class="recipe-ingredients__amount">{{ format_amount(item.amount, item.unit) }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        <ol class="recipe-steps">
            {% for step in recipe.steps %}
            <li class="recipe-step-item">
                <div class="recipe-step-item__body">
                    <h3>Шаг {{ loop.index }}</h3>
                    <p>{{ step.instruction }}</p>
                    {% if step.image_path and not minimal_view %}
                    <img
                        src="{{ step.image_path }}"
                        alt="Шаг {{ loop.index }}"
                        class="recipe-step-item__image"
                        data-full="{{ step.image_path }}"
                    />
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ol>
    </div>
</section>
{% endblock %}
{% block extra_scripts %}
<script src="{{ url_for('static', path='/js/recipe_detail.js') }}" defer></script>
{% endblock %}
