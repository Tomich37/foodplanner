<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>{% block title %}FoodPlanner{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}?v={{ static_version }}" />
    {% block extra_styles %}{% endblock %}
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='/templates/favicon.ico') }}" />
</head>
<body{% if current_user and current_user.is_banned %} data-user-banned="1"{% endif %}>
<!-- Yandex.Metrika counter -->
<script type="text/javascript" nonce="{{ request.state.csp_nonce }}">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=107029252', 'ym');

    ym(107029252, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", referrer: document.referrer, url: location.href, accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/107029252" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<header class="header">
    <div class="container header__inner">
        <a href="{{ url_for('index') }}" class="logo" data-nav-home>FoodPlanner</a>
        <button class="nav-toggle" data-nav-toggle aria-label="Переключить меню">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <nav class="nav" data-nav-menu>
            {% set current_path = request.url.path %}
            <a
                href="/"
                class="nav__link {% if current_path == '/' %}nav__link--active{% endif %}"
                >Главная</a
            >
            <a
                href="{{ url_for('recipes_list') }}"
                class="nav__link {% if current_path.startswith('/recipes') %}nav__link--active{% endif %}"
                >Рецепты</a
            >
            <a
                href="{{ url_for('menu_list') }}"
                class="nav__link {% if current_path.startswith('/menu') %}nav__link--active{% endif %}"
                >Планы питания</a
            >
            {% if current_user and current_user.is_admin %}
            <a
                href="{{ url_for('admin_users') }}"
                class="nav__link {% if current_path.startswith('/admin') %}nav__link--active{% endif %}"
                >Админка</a
            >
            {% endif %}
            {% if current_user %}
            <a
                href="{{ url_for('profile') }}"
                class="nav__link {% if current_path.startswith('/profile') %}nav__link--active{% endif %}"
                >Профиль</a
            >
            {% endif %}
        </nav>
        {% if current_user %}
        <div class="header__profile">
            <div class="avatar">
                {{ (current_user.full_name or current_user.email)[0]|upper }}
            </div>
            <div class="profile-info">
                <div class="profile-name">
                    {{ current_user.full_name or current_user.email }}
                </div>
                <form method="post" action="{{ url_for('logout') }}">
                    {{ csrf_input(request) }}
                    <button type="submit" class="profile-logout">Выйти</button>
                </form>
            </div>
        </div>
        {% else %}
        <div class="header__auth">
            <a href="{{ url_for('login_form') }}" class="btn btn--ghost btn--small">Войти</a>
            <a href="{{ url_for('register_form') }}" class="btn btn--primary btn--small"
                >Регистрация</a
            >
        </div>
        {% endif %}
    </div>
</header>

<main>
    {% block content %}{% endblock %}
</main>

{% if current_user and current_user.is_banned %}
<div class="banned-modal" id="banned-modal" aria-hidden="true">
    <div class="banned-modal__backdrop" data-banned-modal-close></div>
    <div class="banned-modal__content" role="dialog" aria-modal="true" aria-labelledby="banned-modal-title">
        <h2 id="banned-modal-title">Аккаунт заблокирован</h2>
        <p>
            Вы не можете создавать новые рецепты, потому что ваша учетная запись ограничена администратором.
            Остальные разделы сервиса остаются доступными. Если вы считаете это ошибкой,
            свяжитесь с поддержкой или администратором проекта.
        </p>
        <button type="button" class="btn btn--primary" data-banned-modal-close>Понятно</button>
    </div>
</div>
{% endif %}

<footer class="footer">
    <div class="container footer__inner">
        <div>© {{ 2025 }} FoodPlanner</div>
        <div class="footer__links">
            <a href="#">О компании</a>
            <a href="#">Политика</a>
            <a href="#">Партнёрская программа</a>
        </div>
    </div>
</footer>

<script src="{{ url_for('static', path='/js/layout.js') }}?v={{ static_version }}" defer></script>
{% block extra_scripts %}{% endblock %}
</body>
</html>
