{% extends "base.html" %}

{% block title %}Рецепты сообщества · FoodPlanner{% endblock %}

{% block content %}
<section class="recipes-list">
    <div class="container">
        <div class="recipes-list__header">
            <div>
                <h1>Рецепты сообщества</h1>
                <p class="recipes-list__subtitle">
                    Здесь собраны все блюда, которые пользователи уже поделились в FoodPlanner.
                    Добавляйте свои идеи и сохраняйте понравившиеся рецепты.
                </p>
            </div>
            {% if current_user %}
            <a href="{{ url_for('recipes_new') }}" class="btn btn--primary">Создать рецепт</a>
            {% endif %}
        </div>
        <div class="recipes-filters">
            <form
                class="recipes-search"
                method="get"
                data-recipes-search
                data-search-url="{{ url_for('recipes_search') }}"
            >
                <input
                    id="recipes-search-input"
                    type="search"
                    name="q"
                    placeholder="Поиск по названию или ингредиентам"
                    value="{{ search_query or '' }}"
                    aria-label="Поиск по названию или ингредиентам"
                />
                {% for tag in selected_tags %}
                <input type="hidden" name="tags" value="{{ tag }}" />
                {% endfor %}
                <div class="recipes-search__actions">
                    <button type="submit" class="btn btn--primary btn--small">Искать</button>
                    {% if search_query %}
                    <button type="button" class="btn btn--ghost btn--small" data-clear-search>Сбросить поиск</button>
                    {% endif %}
                </div>
            </form>
            {% if primary_tags or extra_tags or selected_tags %}
            <div class="recipes-filters__controls">
                <div class="recipes-filters__tags">
                    {% if primary_tags %}
                    {% for tag in primary_tags %}
                    <button
                        type="button"
                        class="btn btn--ghost tag-button {% if selected_tags and tag.value in selected_tags %}tag-button--active{% endif %}"
                        data-filter-tag="{{ tag.value }}"
                    >
                        {{ tag.label }}
                    </button>
                    {% endfor %}
                    {% endif %}
                    {% if extra_tags %}
                    <div
                        class="recipes-filters__extra"
                        data-extra-dropdown
                        data-extra-tag-values="{{ extra_tag_values | join(',') }}"
                    >
                        <button
                            type="button"
                            class="btn btn--ghost btn--small recipes-filters__extra-toggle"
                            data-extra-dropdown-toggle
                            aria-expanded="false"
                            aria-haspopup="true"
                        >
                            <span>Дополнительные теги</span>
                            <span class="recipes-filters__extra-count" data-extra-selected-count>
                                {% if selected_extra_tags %}({{ selected_extra_tags | length }}){% endif %}
                            </span>
                            <span class="recipes-filters__extra-arrow" aria-hidden="true">&#9662;</span>
                        </button>
                        <div class="recipes-filters__extra-panel" data-extra-dropdown-panel>
                            <p class="recipes-filters__hint">
                                Отметьте подходящие теги и нажмите «Применить»
                            </p>
                            <div class="recipes-filters__extra-list">
                                {% for tag in extra_tags %}
                                <label class="recipes-filters__extra-option">
                                    <input
                                        type="checkbox"
                                        value="{{ tag.value }}"
                                        {% if tag.value in selected_tags %}checked{% endif %}
                                        data-extra-tag-checkbox
                                    />
                                    <span>{{ tag.label }}</span>
                                </label>
                                {% endfor %}
                            </div>
                            <div class="recipes-filters__extra-actions">
                                <button type="button" class="btn btn--primary btn--small" data-extra-apply>
                                    Применить
                                </button>
                                <button type="button" class="btn btn--ghost btn--small" data-extra-clear>
                                    Сбросить
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if selected_tags %}
                    <button type="button" class="btn btn--ghost recipes-filters__reset" data-reset-tags>
                        Сбросить фильтры
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
        <div class="recipes-results" data-recipes-results>
            {% include "partials/recipes_grid.html" %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/pages/recipes.css') }}?v={{ static_version }}" />
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', path='/js/recipes.js') }}?v={{ static_version }}" defer></script>
{% endblock %}
